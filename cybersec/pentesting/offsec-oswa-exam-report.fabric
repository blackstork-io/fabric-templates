document "offsec_oswa_exam_report" {

  meta {
    name = "Offensive Security OSWA Exam Documentation"

    author = "Sergey Polzunov <sergey@blackstork.io>"

    description = <<-EOT
      The Offensive Security OSMR exam documentation contains all efforts that
      were conducted in order to pass the Offensive Security macOS Researcher
      exam. This report will be graded from a standpoint of correctness and
      fullness to all aspects of the exam. The purpose of this report is to
      ensure that the student has the technical knowledge required to pass the
      qualifications for the Offensive Security macOS Researcher certification.

      References:
        - https://www.offsec.com/
        - https://www.offsec.com/courses/web-200/
        - https://www.offsec.com/oswa-online/OSWA-Exam-Report.docx
        - https://github.com/noraj/OSCP-Exam-Report-Template-Markdown/blob/master/src/OSWA-exam-report-template_OS_v1.md
    EOT

    url = "https://www.offsec.com/courses/web-200/"
    # version = "v.2.0"

    license = "MIT License"
    tags = ["pentesting", "offsec", "exam", "osmr", "exp-312"]

    updated_at = "2024-04-27T13:06:51+0000"
  }

  data inline "findings" {
    hosts = [
      {
        host = "192.168.X.1",
        local_txt = "local-txt-content",
        proof_txt = "proof-txt-content",
        vulnerabilities = [
          {
            name = "Vulnerability 1",
            desc = <<-EOT
              Provide the method and code used to find the vulnerability 1.
            EOT
          },
          {
            name = "Vulnerability 2",
            desc = <<-EOT
              Provide the method and code used to find the vulnerability 2.
            EOT
          },
        ],
        screenshots = ["../../img-placeholder.png"]
        steps = <<-EOT
          Provide a detailed account of your methodology in creating the
          exploits. The steps taken should be able to be easily followed and
          reproducible if necessary.
        EOT
      }
    ]
  }

  title = "Offensive Security OSWA Exam Documentation"

  content frontmatter {
    content = {
      title = "Offensive Security OSWA Exam Documentation",
      # FIXME: fix is coming in https://github.com/blackstork-io/fabric/pull/155
      #  author = {
      #    email = "student@youremailaddress.com",
      #    osid = "XXXXX"
      #  },
      author = "student@youremailaddress.com",
      version = "v.1.0"
    }
  }

  content toc {
    start_level = 1
    end_level = 4
  }

  section "description" {
    title = "Offensive Security OSMR Exam Documentation"

    content text {
      value = <<-EOT
        The Offensive Security OSWA exam documentation contains all efforts that
        were conducted in order to pass the Offensive Security Web Assessor exam.
        This report will be graded from a standpoint of correctness and fullness
        to all aspects of the exam. The purpose of this report is to ensure that
        the student has the technical knowledge required to pass the
        qualifications for the Offensive Security Web Assessor certification.

        The student will be required to fill out this exam documentation fully
        and to include the following sections:
        - Methodology walkthrough and detailed outline of steps taken
        - Each finding with included screenshots, walkthrough, sample code, and
          proof.txt if applicable.
        - Any additional items that were not included
      EOT
    }
  }

  section "summary" {
    title = "High-Level Summary"

    content text {
      value = <<-EOT
        A brief description of the assignments that were solved, including the overall exploitation steps.

        {{ range $index, $a := .data.inline.findings.assignments }}
        *Assignment {{ add $index 1 }}:*
        {{ $a.exploitation_steps_summary }}
        {{ end }}

      EOT
    }
  }

  section "host_findings_0" {
    title = "{{ (index .data.inline.findings.hosts 0).host }}"

    section "proofs" {
      title = "Local.txt / Proof.txt"

      content text {
        query = ".data.inline.findings.hosts[0]"

        value = <<-EOT
          {{ with .query_result.local_txt }}
          **local.txt**: `{{ . }}`
          {{ end -}}

          {{- with .query_result.proof_txt }}
          **proof.txt**: `{{ . }}`
          {{ end -}}

          {{- if not (or .query_result.local_txt .query_result.proof_txt) }}
          No proofs were obtained.
          {{ end -}}
        EOT
      }
    }

    # FIXME: this should be a loop
    section "vulnerability_1" {
      title = "{{ (index (index .data.inline.findings.hosts 0).vulnerabilities 0).name }}"

      content text {
        value = "{{ (index (index .data.inline.findings.hosts 0).vulnerabilities 0).desc }}"
      }
    }

    section "vulnerability_2" {
      title = "{{ (index (index .data.inline.findings.hosts 0).vulnerabilities 1).name }}"

      content text {
        value = "{{ (index (index .data.inline.findings.hosts 0).vulnerabilities 1).desc }}"
      }
    }

    section "screenshots" {
      title = "Screenshots"

      content text {
        value = <<-EOT
          Provide screenshots of local.txt and proof.txt contents as stated in
          the Exam Control Panel Objectives.
        EOT
      }

      #FIXME: this should be a loop
      content image {
        src = "{{ (index (index .data.inline.findings.hosts 0).screenshots 0)}}"
      }
    }

    section "steps" {
      title = "Steps"

      content text {
        value = "{{ (index .data.inline.findings.hosts 0).steps }}"
      }
    }
  }
}
