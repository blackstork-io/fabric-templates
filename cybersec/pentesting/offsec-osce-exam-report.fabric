document "offsec_osce_exam_report" {

  meta {
    name = "Offensive Security Certified Expert Exam Report"

    author = "Sergey Polzunov <sergey@blackstork.io>"

    description = <<-EOT
      The Offensive Security OSCE exam report contains all efforts that were
      conducted in order to pass the Offensive Security Certified Expert exam.

      References:
        - https://www.offsec.com/ctp/OSCE-Exam-Report.docx
        - https://github.com/noraj/OSCP-Exam-Report-Template-Markdown/blob/master/src/OSCE-exam-report-template_OS_v1.md
    EOT

    url = "https://www.offsec.com/certificates/osce3/"
    # version = "v.1.0"

    license = "MIT License"
    tags = ["pentesting", "offsec", "osce"]

    updated_at = "2024-04-20T10:46:51+0000"
  }

  data inline "findings" {
    hosts = [
      {
        host = "192.168.XX.200",
        proof = "the-contents-of-proof-txt",

        vulnerable_command = <<-EOT
          Provide the command that was found to be exploitable.
        EOT

        vulnerability_identification = <<-EOT
          Provide the method and code used to find the vulnerability.
        EOT

        poc_code = <<-EOT
          Provide the final proof of concept code used to gain access to the server.
        EOT

        steps = <<-EOT
          Provide a detailed account of your methodology in creating the exploit.
          The steps taken should be able to be easily followed and reproducible if
          necessary.
        EOT
      },
      {
        host = "192.168.XX.220",
        proof = "the-contents-of-proof-txt",

        vulnerable_code = <<-EOT
          Provide the vulnerable code that was found to be exploitable.
        EOT

        privilege_escalation =<<-EOT
          Provide the method and code used to find the vulnerability.
        EOT

        poc_code = <<-EOT
          Provide the final proof of concept code used to gain access to the server.
        EOT

        # Provide a screenshot of the id command and the contents of proof.txt.
        screenshots = ["https://source.unsplash.com/random/600x400/?kittens"]

        steps = <<-EOT
          Provide a detailed account of your methodology in creating the exploit.
          The steps taken should be able to be easily followed and reproducible if
          necessary.
        EOT
      },
      {
        host = "192.168.XX.201",

        # Screenshot requirements are detailed in the control panel.
        screenshots = ["https://source.unsplash.com/random/600x400/?kittens"]

        steps = <<-EOT
          Provide a detailed account of your methodology in creating the exploit.
          The steps taken should be able to be easily followed and reproducible if
          necessary.
        EOT
      },
      {
        host = "192.168.XX.240",

        poc_code = <<-EOT
          Provide the final proof of concept code used to gain access to the server.
        EOT

        # Screenshot requirements are detailed in the control panel.
        screenshots = ["https://source.unsplash.com/random/600x400/?kittens"]

        steps = <<-EOT
          Provide a detailed account of your methodology in creating the exploit.
          The steps taken should be able to be easily followed and reproducible if
          necessary.
        EOT
      },
    ]
  }

  title = "Offensive Security OSCE Exam Documentation"

  content frontmatter {
    content = {
      title = "Offensive Security Certified Expert Exam Report",
      # FIXME: fix is coming in https://github.com/blackstork-io/fabric/pull/155
      #  author = {
      #    email = "student@youremailaddress.com",
      #    osid = "XXXXX"
      #  },
      author = "student@youremailaddress.com",
      version = "v.1.0"
    }
  }

  content toc {
    start_level = 1
  }

  section "intro" {
    title = "Offensive-Security OSCE Exam Documentation"

    content text {
      value = <<-EOT
        The Offensive Security OSCE exam documentation contains all efforts that
        were conducted in order to pass the Offensive Security Certified Expert
        exam. This report will be graded from a standpoint of correctness and
        fullness to all aspects of the exam. The purpose of this report is to
        ensure that the student has the technical knowledge required to pass the
        qualifications for the Offensive Security Certified Expert certification.

        The student will be required to fill out this exam documentation fully
        and to include the following sections:

        - Methodology walkthrough and detailed outline of steps taken.
        - Each finding with included screenshots, walkthrough, sample code, and proof.txt if applicable.
        - Any additional items that were not included
      EOT
    }
  }

  # FIXME: each section below needs to be `for_each` member
  # and subsections need to have condition checks
  # https://github.com/blackstork-io/fabric/issues/142

  section "host_findings_0" {
    title = "{{ (index .data.inline.findings.hosts 0).host }}"

    section "proof_txt" {
      title = "proof.txt"

      content text {
        value = "{{ (index .data.inline.findings.hosts 0).proof }}"
      }
    }

    section "vulnerable_command" {
      title = "Vulnerable Command"

      content text {
        value = "{{ (index .data.inline.findings.hosts 0).vulnerable_command }}"
      }
    }

    section "vulnerability_identification" {
      title = "Vulnerability Identification"

      content text {
        value = "{{ (index .data.inline.findings.hosts 0).vulnerability_identification }}"
      }
    }

    section "poc_code" {
      title = "PoC Code"

      content text {
        value = "{{ (index .data.inline.findings.hosts 0).poc_code }}"
      }
    }

    section "steps" {
      title = "Steps"

      content text {
        value = "{{ (index .data.inline.findings.hosts 0).steps }}"
      }
    }
  }

  section "host_findings_1" {
    title = "{{ (index .data.inline.findings.hosts 1).host }}"

    section "proof_txt" {
      title = "proof.txt"

      content text {
        value = "{{ (index .data.inline.findings.hosts 1).proof }}"
      }
    }

    section "vulnerable_code" {
      title = "Vulnerable Code"

      content text {
        value = "{{ (index .data.inline.findings.hosts 1).vulnerable_code }}"
      }
    }

    section "privilege_escalation" {
      title = "Privilege Escalation"

      content text {
        value = "{{ (index .data.inline.findings.hosts 1).privilege_escalation }}"
      }
    }

    section "poc_code" {
      title = "PoC Code"

      content text {
        value = "{{ (index .data.inline.findings.hosts 1).poc_code }}"
      }
    }

    section "screenshots" {
      title = "Screenshots"

      # FIXME: should be a loop
      # FIXME: should render the source -- https://github.com/blackstork-io/fabric/issues/163
      content image {
        src = "{{ index (index .data.inline.findings.hosts 1).screenshots 0 }}"
      }
    }

    section "steps" {
      title = "Steps"

      content text {
        value = "{{ (index .data.inline.findings.hosts 1).steps }}"
      }
    }
  }

  section "host_findings_2" {
    title = "{{ (index .data.inline.findings.hosts 2).host }}"

    section "screenshots" {
      title = "Screenshots"

      # FIXME: should be a loop
      # FIXME: should render the source -- https://github.com/blackstork-io/fabric/issues/263
      content image {
        src = "{{ index (index .data.inline.findings.hosts 2).screenshots 0 }}"
      }
    }

    section "steps" {
      title = "Steps"

      content text {
        value = "{{ (index .data.inline.findings.hosts 2).steps }}"
      }
    }
  }

  section "host_findings_3" {
    title = "{{ (index .data.inline.findings.hosts 3).host }}"

    section "poc_code" {
      title = "PoC Code"

      content text {
        value = "{{ (index .data.inline.findings.hosts 3).poc_code }}"
      }
    }

    section "screenshots" {
      title = "Screenshots"

      # FIXME: should be a loop
      # FIXME: should render the source -- https://github.com/blackstork-io/fabric/issues/263
      content image {
        src = "{{ index (index .data.inline.findings.hosts 3).screenshots 0 }}"
      }
    }

    section "steps" {
      title = "Steps"

      content text {
        value = "{{ (index .data.inline.findings.hosts 3).steps }}"
      }
    }
  }

  section "outro" {
    title = "Additional Items Not Mentioned in the Report"

    content text {
      value = <<-EOT
        This section is placed for any additional items that were not mentioned in the overall report.
      EOT
    }
  }

}
